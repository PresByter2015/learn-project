var conf=require("./cct-wxa-conf"),fvidKey="_ccfvid",requestCacheKey="_ccofrc",util={extend:function(e,n,t){const r=e[n];return e[n]=function(){const e=Array.prototype.slice.call(arguments,0),n=t.apply(this,e);return r?r.apply(this,e):n;},e;},getFirstVistorId:function(){let e=wx.getStorageSync(fvidKey);return e||(e=(new Date).getTime()+Math.floor(1e6*Math.random()),wx.setStorageSync(fvidKey,e)),e;},generAlphaId:function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);},getSystemInfo:function(){return wx.getSystemInfoSync();},assign:function(e,n){for(const t in n)n.hasOwnProperty(t)&&""!==n[t]&&void 0!=n[t]&&(e[t]=n[t]);return e;},joinParameters:function(e,n){let t,r,o,a,c=[];for(t in e)if(e.hasOwnProperty(t)&&""!==e[t]&&"undefined"!=typeof e[t])if(o=util.getType(e[t]),"object"==o){a=[];for(r in e[t])e[t].hasOwnProperty(r)&&""!==e[t][r]&&"undefined"!=typeof e[t][r]&&a.push([r,":",encodeURIComponent(e[t][r])].join(""));a.length&&c.push([t,"=",a.join(";")].join(""));}else c.push([t,"=",encodeURIComponent(e[t])].join(""));return c.join(n);},getType:function(e){const n=Object.prototype.toString.call(e).toLowerCase();return"[object number]"==n?"number":"[object string]"==n?"string":"[object array]"==n?"array":"[object object]"==n?"object":"[object undefined]"==n?"undefined":"unknow";},getPreviousUrl:function(){try{const e=getCurrentPages();if(e.length>1){let n=e[e.length-2],t=n.route,r=n.options,o=t;return Object.keys(r).length&&(o+="?"+util.joinParameters(r,"&")),o;}}catch(e){}return"";},getCurrentUrl:function(){try{let e=getCurrentPages(),n=e[e.length-1],t=n.route,r=n.options,o=t;return Object.keys(r).length&&(o+="?"+util.joinParameters(r,"&")),o;}catch(e){}return"";}},g={jsv:"1_0_0",seq:0,isConnected:!0,fvid:"",pageId:"",on:{wxak:conf.appKey,wxaid:conf.appId},at:{},from:{},env:{},user:{}},appTracker={onLaunch:function(e){g.from.scnid=e.scene,e.referrerInfo&&(g.from.rwxaid=e.referrerInfo.appId);const n={curl:e.path+"?"+util.joinParameters(e.query,"&")};tracker.addToQueue("track","app","wxal",n);},onShow:function(e){g.from.scnid=e.scene,e.referrerInfo&&(g.from.rwxaid=e.referrerInfo.appId);const n={curl:e.path+"?"+util.joinParameters(e.query,"&")};tracker.addToQueue("track","app","wxas",n);},onHide:function(){tracker.addToQueue("track","app","wxah");}},pageTracker={onShow:function(){tracker.addToQueue("track","app","wxaps");},onHide:function(){tracker.addToQueue("track","app","wxaph");},onUnload:function(){tracker.addToQueue("track","app","wxapuld");},onShareAppMessage:function(e){tracker.addToQueue("track","app","wxapsh");},onPullDownRefresh:function(){conf.autoOnPullDownRefresh&&tracker.addToQueue("track","app","wxappdr");},onReachBottom:function(){conf.autoOnReachBottom&&tracker.addToQueue("track","app","wxaprb");}},tracker={clist:[],runing:!1,addToQueue:function(){const e=tracker;e.clist.push(arguments),e.run();},run:function(){let e,n,t,r,o,a=tracker;a.runing||(a.runing=!0,e=a.clist.shift(),e?(t=e[0],r=e[1],n=t+r.replace(r.charAt(0),r.charAt(0).toUpperCase()),a[n]?(o=Array.prototype.slice.call(e,2),o.unshift(function(){a.runing=!1,a.run();}),a[n].apply(a,o)):a.runing=!1):a.runing=!1);},setAt:function(e,n,t){g.at[n]=t,e();},setFrom:function(e,n,t){g.from[n]=t,e();},setEnv:function(e,n,t){g.env[n]=t,e();},setUser:function(e,n,t){g.user[n]=t,e();},trackApp:function(e,n,t){const r=tracker;t||(t={}),t.ev||(t.ev={});const o=t.ev;o.type=n,r.send(t,e,"s");},trackEvent:function(e,n,t,r,o){const a=tracker,c={ev:{},on:{}},u=c.ev,i=c.on;u.type="wxaevent",n&&(i.cgy=n),t&&(i.act=t),r&&(i.lbl=r),o&&(c.ev.value=o),a.send(c,e,"s");},getServerUrl:function(){const e=conf.baseUrl;return 0==e.indexOf("http")?e:"https://"+e;},getParameters:function(e){let n=util.assign,t=util.joinParameters,r={},o={},a=0,c=(g.fvid,["ev","on","at","from","user","env","ex","ecc","go","et","acid","fvid","jsv","purl","curl"]);for("object"==typeof e&&(r=n(r,e)),"undefined"==typeof r.on&&(r.on={}),r.on=n(r.on,g.on),"undefined"==typeof r.at&&(r.at={}),r.at=n(r.at,g.at),"undefined"==typeof r.from&&(r.from={}),r.from=n(r.from,g.from),"undefined"==typeof r.env&&(r.env={}),r.env=n(r.env,g.env),"undefined"==typeof r.user&&(r.user={}),r.user=n(r.user,g.user),r.jsv=g.jsv,r.purl||(r.purl=util.getPreviousUrl()),r.curl||(r.curl=util.getCurrentUrl()),r.fvid=g.fvid,r.acid=conf.accountId,a=0;a<c.length;a++)"undefined"!=typeof r[c[a]]&&(o[c[a]]=r[c[a]]);return r.seq=g.seq,g.pageId&&(r.ptid=g.pageId),o=n(o,r),o.cb=Math.ceil(1e10*Math.random()),t(o,"&");},send:function(e,n,t){const r=tracker;g.seq++;const o=r.getServerUrl()+t+"?"+r.getParameters(e);if(g.isConnected)wx.request({url:o,method:"get",complete:function(e){n();}});else{let a=wx.getStorageSync(requestCacheKey);a||(a=[]),a.push({url:o,ts:Date.now()}),wx.setStorageSync(requestCacheKey,a),n();}},sendCache:function(){if(g.isConnected){const e=wx.getStorageSync(requestCacheKey);if(e&&e.length){const n=e.shift();wx.setStorageSync(requestCacheKey,e);const t=Date.now()-n.ts,r=n.url+"&et="+t;wx.request({url:r,complete:function(){tracker.sendCache();}});}}}};

!function(){conf.appVersion&&(g.on.wxav=conf.appVersion);const e=conf.getLocation;g.fvid=util.getFirstVistorId(),g.pageId=util.generAlphaId();const n=util.getSystemInfo();g.env.dvcbrand=n.brand,g.env.dvcmodel=n.model,g.env.sr=[n.screenWidth,n.screenHeight].join("_"),g.env.pxlr=n.pixelRatio,g.env.wxv=n.version,g.env.os=n.system,g.env.lngg=n.language,g.env.wxsdkv=n.SDKVersion,e&&wx.getLocation({type:"wgs84",altitude:!1,success:function(e){g.env.lat=e.latitude,g.env.lng=e.longitude,g.geo=e;}}),wx.getNetworkType({success:function(e){g.env.nwktype=e.networkType,g.isConnected="none"!=e.networkType,g.isConnected&&tracker.sendCache();}}),wx.onNetworkStatusChange(function(e){g.isConnected=e.isConnected,g.env.nwktype=e.networkType,g.isConnected&&tracker.sendCache();});}(),function(){const e=util.extend,n=App;App=function(t){Object.keys(appTracker).forEach(function(n){e(t,n,appTracker[n]);});const r=conf.accountId||"cct";t[r]=tracker.addToQueue,n(t);};const t=Page;Page=function(n){Object.keys(pageTracker).forEach(function(t){e(n,t,pageTracker[t]);}),t(n);};}();